{
    "version": "https://jsonfeed.org/version/1",
    "title": "筆記ZONE • All posts by \"ubuntu\" tag",
    "description": "",
    "home_page_url": "https://zonego.tw",
    "items": [
        {
            "id": "https://zonego.tw/2022/12/25/ubuntu22-netsetting/",
            "url": "https://zonego.tw/2022/12/25/ubuntu22-netsetting/",
            "title": "Ubuntu 22.04 設定網路連線",
            "date_published": "2022-12-25T10:44:10.000Z",
            "content_html": "<span id=\"more\"></span>\n\n<p>Ubuntu 20.04 後改用 netplan 作為指令網路設定工具</p>\n<h2 id=\"設定檔\"><a href=\"#設定檔\" class=\"headerlink\" title=\"設定檔\"></a>設定檔</h2><p>netplan 設定檔預設放在 <code>/etc/netplan/00-installer-config.yaml</code></p>\n<blockquote>\n<p>修改及套用需要 root 權限</p>\n</blockquote>\n<h3 id=\"查看網卡代號\"><a href=\"#查看網卡代號\" class=\"headerlink\" title=\"查看網卡代號\"></a>查看網卡代號</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">ip addr<br></code></pre></td></tr></table></figure>\n<p>跑出來的結果像這樣</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=\"hljs-number\">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=\"hljs-number\">1000</span><br>    <span class=\"hljs-attribute\">link</span>/loopback <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span> brd <span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span>:<span class=\"hljs-number\">00</span><br>    <span class=\"hljs-attribute\">inet</span> <span class=\"hljs-number\">127.0.0.1</span>/<span class=\"hljs-number\">8</span> scope host lo<br>       <span class=\"hljs-attribute\">valid_lft</span> forever preferred_lft forever<br>    <span class=\"hljs-attribute\">inet6</span> ::<span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">128</span> scope host<br>       <span class=\"hljs-attribute\">valid_lft</span> forever preferred_lft forever<br><span class=\"hljs-attribute\">2</span>: ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=\"hljs-number\">1500</span> qdisc fq_codel state UP group default qlen <span class=\"hljs-number\">1000</span><br>    <span class=\"hljs-attribute\">link</span>/ether xx:xx:xx:xx:xx:xx brd xx:xx:xx:xx:xx:xx<br>    <span class=\"hljs-attribute\">altname</span> enp0s18<br>    <span class=\"hljs-attribute\">inet</span> <span class=\"hljs-number\">192</span>.<span class=\"hljs-number\">168</span>.<span class=\"hljs-number\">1</span>.xx/<span class=\"hljs-number\">24</span> brd <span class=\"hljs-number\">172.16.0.255</span> scope global ens18<br>       <span class=\"hljs-attribute\">valid_lft</span> forever preferred_lft forever<br>    <span class=\"hljs-attribute\">inet6</span> <span class=\"hljs-number\">0000</span>::<span class=\"hljs-number\">0000</span>:<span class=\"hljs-number\">0000</span>:<span class=\"hljs-number\">0000</span>:<span class=\"hljs-number\">0000</span>/<span class=\"hljs-number\">64</span> scope link<br>       <span class=\"hljs-attribute\">valid_lft</span> forever preferred_lft forever<br></code></pre></td></tr></table></figure>\n\n<p>編號 2 後面的 <code>ens18</code> 就是網卡代號</p>\n<blockquote>\n<p>我的電腦只有裝一張網卡結果才會只到編號 2，如果有多張網卡會接續列在下面</p>\n</blockquote>\n<p>接下來就是開始編輯設定檔</p>\n<p>使用 nano 編輯器修改設定檔</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">nano /etc/netplan/50-cloud-init.yaml<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"使用-DHCP-自動設定-IP\"><a href=\"#使用-DHCP-自動設定-IP\" class=\"headerlink\" title=\"使用 DHCP 自動設定 IP\"></a>使用 DHCP 自動設定 IP</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">network:</span><br>  <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span><br>  <span class=\"hljs-attr\">renderer:</span> <span class=\"hljs-string\">networkd</span><br>  <span class=\"hljs-attr\">ethernets:</span><br>    <span class=\"hljs-comment\"># 下面 ens18 改成你的網卡代號</span><br>    <span class=\"hljs-attr\">ens18:</span><br>      <span class=\"hljs-attr\">dhcp4:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-comment\"># 如果有多張網卡，設定繼續加在下面</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"設定固定-IP\"><a href=\"#設定固定-IP\" class=\"headerlink\" title=\"設定固定 IP\"></a>設定固定 IP</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">network:</span><br>  <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span><br>  <span class=\"hljs-attr\">ethernets:</span><br>    <span class=\"hljs-attr\">ens18:</span><br>      <span class=\"hljs-attr\">addresses:</span><br>      <span class=\"hljs-comment\"># 設定固定 IP</span><br>        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.2</span><span class=\"hljs-string\">/24</span><br>      <span class=\"hljs-comment\"># 預設閘道器</span><br>      <span class=\"hljs-attr\">gateway4:</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.1</span><br>      <span class=\"hljs-comment\"># 預設 DNS</span><br>      <span class=\"hljs-attr\">nameservers:</span><br>        <span class=\"hljs-attr\">addresses:</span> [<span class=\"hljs-number\">8.8</span><span class=\"hljs-number\">.8</span><span class=\"hljs-number\">.8</span>, <span class=\"hljs-number\">1.1</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.1</span>]<br></code></pre></td></tr></table></figure>\n\n<p>固定 IP 中 <code>/24</code> 代表子網遮罩，相當於 　<code>255.255.255.0</code></p>\n<p>如果不會換算，可以參考 IPv4 子網計算機 <a href=\"https://damaha-labo.site/converter/zh-Hant/IT/CalcSubnetMask\">https://damaha-labo.site/converter/zh-Hant/IT/CalcSubnetMask</a></p>\n<p>通常沒特殊需求的話，家用路由器的子網遮罩都是用 <code>/24</code> <code>255.255.255.0</code></p>\n<hr>\n<p>在 ubuntu 22.04 新版的 Netplan 中， <code>gateway4</code> 這個設定已被棄用</p>\n<p>新版的設定檔長這樣</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">network:</span><br>  <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span><br>  <span class=\"hljs-attr\">ethernets:</span><br>    <span class=\"hljs-attr\">ens18:</span><br>      <span class=\"hljs-attr\">addresses:</span><br>      <span class=\"hljs-comment\"># 設定固定 IP</span><br>        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.2</span><span class=\"hljs-string\">/24</span><br>      <span class=\"hljs-comment\"># 預設 DNS</span><br>      <span class=\"hljs-attr\">nameservers:</span><br>        <span class=\"hljs-attr\">addresses:</span> [<span class=\"hljs-number\">8.8</span><span class=\"hljs-number\">.8</span><span class=\"hljs-number\">.8</span>, <span class=\"hljs-number\">1.1</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.1</span>]<br>      <span class=\"hljs-comment\"># 預設閘道器</span><br>      <span class=\"hljs-attr\">routes:</span><br>        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">to:</span> <span class=\"hljs-string\">default</span><br>          <span class=\"hljs-attr\">via:</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.1</span><br></code></pre></td></tr></table></figure>\n\n<p>預設路由的設定，改成可以設定多個預設閘道器(Gateway)</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">routes:</span><br>  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">to:</span> <span class=\"hljs-string\">default</span><br>    <span class=\"hljs-attr\">via:</span> <span class=\"hljs-number\">10.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><br>    <span class=\"hljs-attr\">metric:</span> <span class=\"hljs-number\">200</span><br>  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">to:</span> <span class=\"hljs-string\">default</span><br>    <span class=\"hljs-attr\">via:</span> <span class=\"hljs-number\">11.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><br>    <span class=\"hljs-attr\">metric:</span> <span class=\"hljs-number\">300</span><br></code></pre></td></tr></table></figure>\n<p>其中 <code>metric</code> 代表優先權重，值越小越優先使用</p>\n<h3 id=\"設定-WIFI-連線\"><a href=\"#設定-WIFI-連線\" class=\"headerlink\" title=\"設定 WIFI 連線\"></a>設定 WIFI 連線</h3><h4 id=\"取得-Wifi-網卡代號\"><a href=\"#取得-Wifi-網卡代號\" class=\"headerlink\" title=\"取得 Wifi 網卡代號\"></a>取得 Wifi 網卡代號</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">$ <span class=\"hljs-built_in\">ls</span> /sys/class/net<br>enp0s25  lo  wlp3s0<br></code></pre></td></tr></table></figure>\n\n<p>通常在 Ubuntu 22.04 中 Wifi 網卡代號通常是 <code>wlan0</code> 或是 <code>wlp3s0</code></p>\n<p>在設定檔下面加上 Wifi 的部分即可</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">network:</span><br>    <span class=\"hljs-attr\">ethernets:</span><br>        <span class=\"hljs-attr\">eth0:</span><br>            <span class=\"hljs-attr\">dhcp4:</span> <span class=\"hljs-literal\">true</span><br>            <span class=\"hljs-attr\">optional:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">2</span><br>    <span class=\"hljs-attr\">wifis:</span><br>        <span class=\"hljs-attr\">wlp3s0:</span><br>            <span class=\"hljs-attr\">optional:</span> <span class=\"hljs-literal\">true</span><br>            <span class=\"hljs-attr\">access-points:</span><br>                <span class=\"hljs-attr\">&quot;SSID-NAME-HERE&quot;:</span><br>                    <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">&quot;PASSWORD-HERE&quot;</span><br>            <span class=\"hljs-attr\">dhcp4:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>至於要怎麼找附近可用的熱點…<br><img src=\"/images/content/do_you_guys_not_have_phones.jpg\"></p>\n<h2 id=\"保存、套用設定\"><a href=\"#保存、套用設定\" class=\"headerlink\" title=\"保存、套用設定\"></a>保存、套用設定</h2><p>範例使用的 nano 編輯器，儲存按法：<br><code>Ctrl</code> + <code>X</code>  -&gt;  <code>Y</code></p>\n<p>保存完後，用下面指令測試設定檔有無格式錯誤</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">netplan try<br></code></pre></td></tr></table></figure>\n\n<p>確定網路沒問題，在 120 秒內按 Enter 確定套用。<br>這招可以避免設定固定 IP 時設定錯誤斷網，畢竟很懶的跑去機器旁邊重新設定。</p>\n<p>如果想要直接套用，不用再另外檢查，可以用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">netplan apply<br></code></pre></td></tr></table></figure>\n\n<p>檢查是否設定成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><code class=\"hljs bash\">ip addr<br></code></pre></td></tr></table></figure>\n\n<p>看一下網卡有沒有配到 IP</p>\n<blockquote>\n<p>如果你的 Raspberry Pi 也是裝 Ubuntu，網路設定也是這樣修改</p>\n</blockquote>\n<h2 id=\"參考資料\"><a href=\"#參考資料\" class=\"headerlink\" title=\"參考資料\"></a>參考資料</h2><p>Netplan 設定範例 <a href=\"https://netplan.io/examples\">https://netplan.io/examples</a></p>\n",
            "tags": [
                "網路",
                "Ubuntu"
            ]
        }
    ]
}